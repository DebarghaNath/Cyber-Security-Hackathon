<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Missing Person Matcher — Prototype</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
.card { max-width: 600px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; }
.row { display: flex; gap: 20px; }
img { max-width: 200px; max-height: 200px; margin-top: 8px; }
.result { padding: 10px; margin-top: 12px; border-radius: 5px; }
.result.ok { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.result.bad { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
</style>
</head>
<body>
<div class="card">
<h1>Missing Person Matcher — Prototype</h1>
<p>Choose two face photos (missing person report photo & unidentified body photo) and click <strong>Match</strong>.</p>

<div class="row">
<div>
<label>Photo A (missing person)</label><br />
<input id="fileA" type="file" accept="image/*"><br>
<img id="previewA" src="" alt="preview A" />
</div>
<div>
<label>Photo B (UIDB)</label><br />
<input id="fileB" type="file" accept="image/*"><br>
<img id="previewB" src="" alt="preview B" />
</div>
</div>

<div style="margin-top:12px">
<button id="matchBtn">Match</button>
<span id="status"></span>
</div>

<div id="resultBox" class="result" style="display:none"></div>
</div>
<script>
  const fileA = document.getElementById('fileA');
  const fileB = document.getElementById('fileB');
  const previewA = document.getElementById('previewA');
  const previewB = document.getElementById('previewB');
  const matchBtn = document.getElementById('matchBtn');
  const status = document.getElementById('status');
  const resultBox = document.getElementById('resultBox');
  
  // Preview selected images
  function preview(fileInput, imgEl){
      const f = fileInput.files[0];
      imgEl.src = f ? URL.createObjectURL(f) : '';
  }
  
  fileA.addEventListener('change', ()=> preview(fileA, previewA));
  fileB.addEventListener('change', ()=> preview(fileB, previewB));
  
  // Handle match button click
  matchBtn.addEventListener('click', async ()=>{
      resultBox.style.display = 'none';
      status.textContent = 'Uploading & matching...';
      if(!fileA.files[0] || !fileB.files[0]){ 
          status.textContent = 'Please select both images.'; 
          return; 
      }
  
      const fd = new FormData();
      fd.append('imageA', fileA.files[0]);
      fd.append('imageB', fileB.files[0]);
  
      try{
          const resp = await fetch('http://localhost:5001/match', {method:'POST', body: fd});
          if(!resp.ok) throw new Error('Server error: '+resp.status);
          const json = await resp.json();
          status.textContent = '';
  
          const score = json.similarity_score;
          resultBox.style.display = 'block';
          // Consider similarity > 0.5 as a possible match (adjust threshold as needed)
          const isMatch = score > 0.5;
          resultBox.className = 'result ' + (isMatch ? 'ok' : 'bad');
          resultBox.innerHTML = `
              <strong>${isMatch ? 'Possible match' : 'No match'}</strong><br>
              Similarity Score: ${score.toFixed(3)}
          `;
      }catch(err){
          status.textContent = '';
          resultBox.style.display = 'block';
          resultBox.className = 'result bad';
          resultBox.innerHTML = '<strong>Error:</strong> ' + err.message;
      }
  });
</script>
  
</body>
</html>
